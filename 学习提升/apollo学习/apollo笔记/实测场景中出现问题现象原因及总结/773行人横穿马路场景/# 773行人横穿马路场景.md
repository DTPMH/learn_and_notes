# 773行人横穿马路场景

## 场景实现分析：   
首先车以10m/s的巡航速度行驶，当测试车距离预计碰撞点还有4.5s时，行人开始横穿马路，并在碰撞点停止，此时车应该逐渐减速停下，等待行人离去，车加速行驶至目标点。

## 2022/08/29 实测现象
初始时测试车与行人之间距离60m,开启自动驾驶模式，测试车逐渐加速到巡航速度(10m/s)；当两者之间的距离为36m时行人开始有初速度（0.4m/s）但是此时行人轨迹并没有生成;当行人速度达到1.5m/s时，行人轨迹出现，此时两者距离为25m;此时规划开始构建虚拟stop-wall,测试车开始减速；当行人在车道线中停止时，测试车选择向旁边车道绕行，继续行驶。  

**录制bag包：**  media/share1/PnC/20220829-bag/773/20220829164350.record.00000

## 现象分析
根据aollo中的决策信息，apollo规划模块在速度规划时会对障碍物的类型判断，若其是行人，则会生成stop_wall,促使速度轨迹减速，在行人前停车，不会选择借道而行。

1. borrow的条件：   
            -只有一条引导线    
            -速度小于5m/s    
            -存在周期大于3个周期    
            -障碍物前后20m内不存在stop_sign与signal区域    
            -障碍物在终点之前    
            -车与障碍物之间的距离小于35m   
            -静态障碍物
            -障碍物旁边车道可借道    
    根据以上条件判断，行人不满足借道条件，因此apollo不会选择借道，而是会停下，等待行人离开。

2. 车选择借道的原因    
在对bag包分析时发现，预测模块发出的行人障碍物的属性中：is_static == 1,因此apollo系统会将行人看做时静态障碍物，由此满足以上借道条件，因此会产生借道的决策。

## 解决策略   
将对行人的规划策略迁移到速度规划中，在针对障碍物调整path_boundary时，若是该障碍物type是行人(pedestrian),则不对该障碍物进行处理，因此在path_borrow_decide中不会对行人实行借道处理。

### 该解决方法对其他模块的影响

该解决方法会导致emergency_light在遇到行人停止时误触发。   

解决措施：   
在判断emergency_light时将stop_obstacle的类型加入判断条件中，若stop_onstacle的type是pedestrian或者bicycle，则停下时不触发emergency_light   

## 目前状态   
已开发完成，测试完成。